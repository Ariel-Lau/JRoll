/*! JRollViewer v0.2.2 ~ (c) 2016 Author:BarZu Git:https://github.com/chjtx/JRoll/tree/master/plugins/jroll-viewer */
!function(e,r,t){"use strict";function l(e){var t=r.createElement("div");return t.className=e,t}var o,i=e.innerWidth,n=e.innerHeight,s=i/n,a=0,c=[],d=0,p=function(e,l){var o=this;o.el="string"==typeof e?r.querySelector(e):e,o.el.addEventListener("click",function(e){o._click(e)},!1),o.options={JRoll:t};for(var i in l)o.options[i]=l[i];o._init()};p.version="0.2.2",p.prototype={_createStyle:function(){var e=r.getElementById("jroll_style"),t="\n/* jroll-viewer */\n.jroll-viewer{display:none;height:100%;width:100%;overflow:hidden;background:#000;position:absolute;top:0;left:0;z-index:9999}.jroll-viewer.duration{-webkit-transition-duration:200ms;transition-duration:200ms}.jroll-viewer.small{-webkit-transform:scale(0.01,0.01);transform:scale(0.01,0.01);display:block}.jroll-viewer.normal{-webkit-transform:scale(1,1) !important;transform:scale(1,1) !important}.jroll-viewer-scroller{height:100%}.jroll-viewer-page{height:100%;position:absolute}.jroll-viewer-item{width:100%;height:100%;position:relative;overflow:hidden}.jroll-viewer-img{position:absolute}.jroll-viewer-pointer{color:#fff;font-size:12px;position:absolute;left:0;bottom:40px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.jroll-viewer-pointer span{display:block;width:4px;height:4px;border-radius:10px;background:#666;float:left;margin:0 5px}.jroll-viewer-pointer span.active{background:#fff}\n";e?/jroll-viewer/.test(e.innerHTML)||(e.innerHTML+=t):(e=r.createElement("style"),e.id="jroll_style",e.innerHTML=t,r.head.appendChild(e))},_createImg:function(e,r){var t,l=this,p="",v="";d=r.length,t="number"==typeof e?e:null;for(var w=0;w<d;w++)p+='<div class="jroll-viewer-page" style="width:'+i+"px;left:"+w*i+'px"><div class="jroll-viewer-item"><img src="'+(l.options.data?r[w].dataset[l.options.data]:r[w].src)+'" class="jroll-viewer-img"></div></div>',d<=5&&(v+="<span></span>"),null===t&&("object"==typeof e&&e===r[w]||"string"==typeof e&&e===r[w].getAttribute("src"))&&(t=w);l.scroller.innerHTML=p,l.pointer.innerHTML=v,o=l.pointer.querySelectorAll("span");var h,f=l.scroller.querySelectorAll(".jroll-viewer-item");for(w=0;w<d;w++)h=new l.options.JRoll(f[w],{id:r[w].getAttribute("jroll-viewer-id"),zoom:!0,scrollFree:!0,bounce:!1,autoStyle:!1,zoomDuration:0}),r[w].setAttribute("jroll-viewer-id",h.id),h.on("scroll",function(e){var r=this;if(e){var t=r.scroller.offsetHeight<=r.wrapper.clientHeight||Math.abs(r.jroll_viewer_start-e.touches[0].pageX)>50,o=r.x===r.maxScrollX&&t,i=r.x===r.minScrollX&&t;(o||i)&&e&&r.call(l.jroll,e)}}).on("scrollStart",function(e){this.jroll_viewer_start=e.touches[0].pageX}).on("zoomStart",function(){l["switch"](a)}).on("zoomEnd",function(){var e,r=this;r.scroller.jroll_viewer_ratio>s?(e=(n-r.scroller.height*r._z.scale)/2,r.scroller.style.top=e<0?0:e+"px"):(e=(i-r.scroller.width*r._z.scale)/2,r.scroller.style.left=e<0?0:e+"px")}).scroller.onload=function(){l._imgOnload(this)},c.push(h);return t},_click:function(e){var r=e.target,t=this;"IMG"===r.tagName&&r.hasAttribute("jroll-viewer-image")&&t.show(r)},_init:function(){var t=this;return t.viewer=r.getElementById("jroll_viewer"),t.viewer?(t.scroller=t.viewer.querySelector(".jroll-viewer-scroller"),t.pointer=t.viewer.querySelector(".jroll-viewer-pointer"),void(t.jroll=t.scroller.jroll)):(t._createStyle(),t.viewer=l("jroll-viewer"),t.scroller=l("jroll-viewer-scroller"),t.pointer=l("jroll-viewer-pointer"),t.viewer.id="jroll_viewer",t.viewer.appendChild(t.scroller),t.viewer.appendChild(t.pointer),r.body.appendChild(t.viewer),t.viewer.onclick=function(){t.hide()},t.jroll=new t.options.JRoll(t.viewer,{scrollY:!1,scrollX:!0,momentum:!1,edgeRelease:!1}).on("scrollStart",function(){this.viewerStartTime=(new Date).getTime()}).on("touchEnd",function(){var e=this,r=a*i+e.x;if(e.x!==e.minScrollX&&e.x!==e.maxScrollX&&0!==Math.abs(e.x%i)){var l;l=Math.abs(r)<((new Date).getTime()-e.viewerStartTime<300?10:100)?0:r>0?-1:1,t["switch"](a+l,200)}}).on("scroll",function(e){var r=this,t=c[a],l=r.directionX===-1&&r.x<-a*i&&t.x>t.maxScrollX,o=1===r.directionX&&r.x>-a*i&&t.x<t.minScrollX;(l||o)&&(r.scrollTo(-a*i,0),r.call(t,e))}),e.addEventListener("resize",t._rotate.bind(t)),void e.addEventListener("orientationchange",t._rotate.bind(t)))},_imgOnload:function(e){var r=this,t=e.width/e.height;e.jroll_viewer_ratio=t,t>s?(e.style.width="100%",e.style.height="auto",e.style.left="0",e.style.top=(n-i/t)/2+"px",e.jroll.options.zoomMax=r.options.zoomMax||e.naturalWidth/i||3):(e.style.width="auto",e.style.height="100%",e.style.left=(i-n*t)/2+"px",e.style.top="0",e.jroll.options.zoomMax=r.options.zoomMax||e.naturalHeight/n||3),e.jroll.maxScrollX=e.jroll.maxScrollY=e.jroll.minScrollX=e.jroll.minScrollY=0},_rotate:function(){i=e.innerWidth,n=e.innerHeight,s=i/n;var r=this;r.jroll.scroller.style.width=i*d+"px",c.forEach(function(e,t){r._imgOnload(e.scroller),e.wrapper.parentElement.style.width=i+"px",e.wrapper.parentElement.style.left=i*t+"px"}),r["switch"](a,0,!0)},_reset:function(e){var r=c[e].scroller,t=r.jroll_viewer_ratio;o&&o.length&&o[e].classList.remove("active"),t>s?r.style.top=(n-i/t)/2+"px":r.style.left=(i-n*t)/2+"px",c[e]._z.scale=1,c[e].scrollTo(0,0).refresh()},_dot:function(e){o&&o.length?o[e].classList.add("active"):this.pointer.innerHTML=e+1+" / "+d},"switch":function(e,r,t){var l=this,o=a;e=parseInt(e),e>=0&&e<d&&(a=e),a===o?(l.jroll.scrollTo(-(i*e),0,r||0),l._dot(a)):l.jroll.scrollTo(-(i*e),0,r||0,!1,function(){for(var o=0,i=d;o<i;o++)o===e?(l._dot(o),c[o].refresh(),t&&l._reset(o)):l._reset(o),o===e||o===e-1||o===e+1?c[o].wrapper.style.display="block":c[o].wrapper.style.display="none";"function"==typeof l.options.afterSwitch&&r&&l.options.afterSwitch(e)})},show:function(e){var t,l=this,o=l.el.querySelectorAll("img[jroll-viewer-image]");c=[],l.viewer.style.visibility="hidden",l.viewer.style.display="block",l.viewer.style.top=r.body.scrollTop+"px",l.scroller.style.width=i*o.length+"px",l.jroll.refresh(),t=l._createImg(e,o),l["switch"](t),l.viewer.classList.add("small"),setTimeout(function(){l.viewer.style.visibility="visible",l.viewer.classList.add("duration"),l.viewer.classList.add("normal")},0)},hide:function(){var e=this;e.viewer.classList.remove("normal"),setTimeout(function(){e.viewer.classList.remove("small"),e.viewer.classList.remove("duration"),e.viewer.style.display="none"},250)}},"undefined"!=typeof module&&module.exports&&(module.exports=p),"function"==typeof define&&define(function(){return p}),e.JRollViewer=p}(window,document,JRoll);