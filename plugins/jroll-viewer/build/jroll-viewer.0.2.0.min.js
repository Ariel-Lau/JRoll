/*! JRollViewer v0.2.0 ~ (c) 2016 Author:BarZu Git:https://github.com/chjtx/JRoll/tree/master/plugins/jroll-viewer */
!function(e,r,l){"use strict";function t(e){var l=r.createElement("div");return l.className=e,l}var o,i,n=e.innerWidth,s=e.innerHeight,a=n/s,c=0,d=[],p=function(e,t){var o=this;o.el="string"==typeof e?r.querySelector(e):e,o.el.addEventListener("click",function(e){o._click(e)},!1),o.options={JRoll:l};for(var i in t)o.options[i]=t[i];o._init()};p.version="0.2.0",p.prototype={_createStyle:function(){var e=r.getElementById("jroll_style"),l="\n/* jroll-viewer */\n.jroll-viewer{display:none;height:100%;width:100%;overflow:hidden;background:#000;position:absolute;top:0;left:0;z-index:9999}.jroll-viewer.duration{-webkit-transition-duration:200ms;transition-duration:200ms}.jroll-viewer.small{-webkit-transform:scale(0.01,0.01);transform:scale(0.01,0.01);display:block}.jroll-viewer.normal{-webkit-transform:scale(1,1) !important;transform:scale(1,1) !important}.jroll-viewer-scroller{height:100%}.jroll-viewer-page{height:100%;position:absolute}.jroll-viewer-item{width:100%;height:100%;position:relative;overflow:hidden}.jroll-viewer-img{position:absolute}.jroll-viewer-pointer{color:#fff;font-size:12px;position:absolute;left:0;bottom:40px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.jroll-viewer-pointer span{display:block;width:4px;height:4px;border-radius:10px;background:#666;float:left;margin:0 5px}.jroll-viewer-pointer span.active{background:#fff}\n";e?/jroll-viewer/.test(e.innerHTML)||(e.innerHTML+=l):(e=r.createElement("style"),e.id="jroll_style",e.innerHTML=l,r.head.appendChild(e))},_createImg:function(e,r){var l,t=this,p="",v="";i=r.length,l="number"==typeof e?e:null;for(var w=0;w<i;w++)p+='<div class="jroll-viewer-page" style="width:'+n+"px;left:"+w*n+'px"><div class="jroll-viewer-item"><img src="'+(t.options.data?r[w].dataset[t.options.data]:r[w].src)+'" class="jroll-viewer-img"></div></div>',i<=5&&(v+="<span></span>"),null===l&&("object"==typeof e&&e===r[w]||"string"==typeof e&&e===r[w].getAttribute("src"))&&(l=w);t.scroller.innerHTML=p,t.pointer.innerHTML=v,o=t.pointer.querySelectorAll("span");var h,u=t.scroller.querySelectorAll(".jroll-viewer-item");for(w=0;w<i;w++)h=new t.options.JRoll(u[w],{id:r[w].getAttribute("jroll-viewer-id"),zoom:!0,scrollFree:!0,bounce:!1,autoStyle:!1,zoomDuration:0}),r[w].setAttribute("jroll-viewer-id",h.id),h.on("scroll",function(e){var r=this;if(e){var l=r.x===r.maxScrollX,o=r.x===r.minScrollX;(l||o)&&e&&r.call(t.jroll,e)}}).on("scrollStart",function(e){this.jroll_viewer_start=e.touches[0].pageX}).on("zoomStart",function(){t["switch"](c)}).on("zoomEnd",function(){var e,r=this;r.scroller.jroll_viewer_ratio>a?(e=(s-r.scroller.height*r._z.scale)/2,r.scroller.style.top=e<0?0:e+"px"):(e=(n-r.scroller.width*r._z.scale)/2,r.scroller.style.left=e<0?0:e+"px")}).scroller.onload=function(){t._imgOnload(this)},d.push(h);return l},_click:function(e){var r=e.target,l=this;"IMG"===r.tagName&&r.hasAttribute("jroll-viewer-image")&&l.show(r)},_init:function(){var l=this;return l.viewer=r.getElementById("jroll_viewer"),l.viewer?(l.scroller=l.viewer.querySelector(".jroll-viewer-scroller"),l.pointer=l.viewer.querySelector(".jroll-viewer-pointer"),void(l.jroll=l.scroller.jroll)):(l._createStyle(),l.viewer=t("jroll-viewer"),l.scroller=t("jroll-viewer-scroller"),l.pointer=t("jroll-viewer-pointer"),l.viewer.id="jroll_viewer",l.viewer.appendChild(l.scroller),l.viewer.appendChild(l.pointer),r.body.appendChild(l.viewer),l.viewer.onclick=function(){l.hide()},l.jroll=new l.options.JRoll(l.viewer,{scrollY:!1,scrollX:!0,momentum:!1}).on("touchEnd",function(){var e=this,r=c*n+e.x;if(e.x!==e.minScrollX&&e.x!==e.maxScrollX&&0!==Math.abs(e.x%n)){var t;t=Math.abs(r)<n/10?0:r>0?-1:1,l["switch"](c+t,200)}}).on("scroll",function(e){var r=this,l=d[c],t=r.directionX===-1&&r.x<-c*n&&l.x>l.maxScrollX,o=1===r.directionX&&r.x>-c*n&&l.x<l.minScrollX;(t||o)&&(r.scrollTo(-c*n,0),r.call(l,e))}),e.addEventListener("resize",l._rotate.bind(l)),void e.addEventListener("orientationchange",l._rotate.bind(l)))},_imgOnload:function(e){var r=this,l=e.width/e.height;e.jroll_viewer_ratio=l,l>a?(e.style.width="100%",e.style.height="auto",e.style.left="0",e.style.top=(s-n/l)/2+"px",e.jroll.options.zoomMax=r.options.zoomMax||e.naturalWidth/n||3):(e.style.width="auto",e.style.height="100%",e.style.left=(n-s*l)/2+"px",e.style.top="0",e.jroll.options.zoomMax=r.options.zoomMax||e.naturalHeight/s||3),e.jroll.maxScrollX=e.jroll.maxScrollY=e.jroll.minScrollX=e.jroll.minScrollY=0},_rotate:function(){n=e.innerWidth,s=e.innerHeight,a=n/s;var r=this;r.jroll.scroller.style.width=n*r.options.images.length+"px",d.forEach(function(e,l){r._imgOnload(e.scroller),e.wrapper.parentElement.style.width=n+"px",e.wrapper.parentElement.style.left=n*l+"px"}),r["switch"](c,0,!0)},_reset:function(e){var r=d[e].scroller,l=r.jroll_viewer_ratio;o.length&&o[e].classList.remove("active"),l>a?r.style.top=(s-n/l)/2+"px":r.style.left=(n-s*l)/2+"px",d[e]._z.scale=1,d[e].scrollTo(0,0).refresh()},_dot:function(e){o.length?o[e].classList.add("active"):this.pointer.innerHTML=e+1+" / "+i},"switch":function(e,r,l){var t=this,o=c;e=parseInt(e),e>=0&&e<i&&(c=e),c===o?(t.jroll.scrollTo(-(n*e),0,r||0),t._dot(c)):t.jroll.scrollTo(-(n*e),0,r||0,!1,function(){for(var o=0,n=i;o<n;o++)o===e?(t._dot(o),d[o].refresh(),l&&t._reset(o)):t._reset(o),o===e||o===e-1||o===e+1?d[o].wrapper.style.display="block":d[o].wrapper.style.display="none";"function"==typeof t.options.afterSwitch&&r&&t.options.afterSwitch(e)})},show:function(e){var l,t=this,o=t.el.querySelectorAll("img[jroll-viewer-image]");d=[],t.viewer.style.visibility="hidden",t.viewer.style.display="block",t.viewer.style.top=r.body.scrollTop+"px",t.scroller.style.width=n*o.length+"px",t.jroll.refresh(),l=t._createImg(e,o),t["switch"](l),t.viewer.classList.add("small"),setTimeout(function(){t.viewer.style.visibility="visible",t.viewer.classList.add("duration"),t.viewer.classList.add("normal")},0)},hide:function(){var e=this;e.viewer.classList.remove("normal"),setTimeout(function(){e.viewer.classList.remove("small"),e.viewer.classList.remove("duration"),e.viewer.style.display="none"},250)}},"undefined"!=typeof module&&module.exports&&(module.exports=p),"function"==typeof define&&define(function(){return p}),e.JRollViewer=p}(window,document,JRoll);